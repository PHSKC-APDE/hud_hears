---
title: "Factors associated with PHA exit and exit type"
author: "Alastair Matheson (Public Health - Seattle & King County)"
date: "3/3/2022"
output: html_document
---

```{=html}
<style type="text/css">

h1 { color: DarkBlue;}
h2 { color: DarkBlue;}
h3 { color: DarkBlue;}
h4 { color: DarkBlue;}
code.r{ /* Code block */
    font-size: 12px;
}
pre { /* Code block - determines code spacing between lines */
    font-size: 14px;
}
</style>
```
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  fig.width = 9,
  fig.asp = 0.8,
  out.width = "100%"
  )
options(knitr.table.format = "html") 
```

## Factors associated with exiting housing support vs not
Note that the "Remained" group is based on a 4:1 match of people who remained in housing to those who exited and should be considered a simple random sample of those who did not exit.

### Individual demographics
```{r exitanyind, include=TRUE}
exit_any_ind %>%
  select(-category) %>%
  kbl(col.names = c("", 
                    paste0("Remained (N = ", number(nrow(covariate_nodeath[covariate_nodeath$id_type == "id_control", ]), big.mark = ","), ")"), 
                    paste0("Exited (N =", number(nrow(covariate_nodeath[covariate_nodeath$id_type == "id_exit", ]), big.mark = ","), ")")
                    )) %>%
  kable_paper("hover", full_width = F, position = "left") %>%
  pack_rows(index = table(exit_any_ind$category))
```
### Household demographics
```{r exitanyhh, include=TRUE}
exit_any_hh %>%
  select(-category) %>%
  kbl(col.names = c("", 
                    paste0("Remained (N = ", number(nrow(covariate_nodeath[covariate_nodeath$id_type == "id_control", ]), big.mark = ","), ")"), 
                    paste0("Exited (N =", number(nrow(covariate_nodeath[covariate_nodeath$id_type == "id_exit", ]), big.mark = ","), ")")
                    )) %>%
  kable_paper("hover", full_width = F, position = "left") %>%
  pack_rows(index = table(exit_any_hh$category))
```





## Factors associated with exit type
### Individual demographics
```{r exittypeind, include=TRUE}
exit_type_ind %>%
  select(-category) %>%
  kbl(col.names = c("", 
                    paste0("Negative (N =", number(nrow(covariate_exits[covariate_exits$exit_category == "Negative", ]), big.mark = ","), ")"), 
                    paste0("Neutral (N =", number(nrow(covariate_exits[covariate_exits$exit_category == "Neutral", ]), big.mark = ","), ")"), 
                    paste0("Positive (N =", number(nrow(covariate_exits[covariate_exits$exit_category == "Positive", ]), big.mark = ","), ")")
                    )) %>%
  kable_paper("hover", full_width = F, position = "left") %>%
  pack_rows(index = table(exit_type_ind$category))

```

### Household demographics
```{r exittypehh, include=TRUE}
exit_type_hh %>%
  select(-category) %>%
  kbl(col.names = c("", 
                    paste0("Negative (N =", number(nrow(covariate_exits[covariate_exits$exit_category == "Negative", ]), big.mark = ","), ")"), 
                    paste0("Neutral (N =", number(nrow(covariate_exits[covariate_exits$exit_category == "Neutral", ]), big.mark = ","), ")"), 
                    paste0("Positive (N =", number(nrow(covariate_exits[covariate_exits$exit_category == "Positive", ]), big.mark = ","), ")")
                    )) %>%
  kable_paper("hover", full_width = F, position = "left") %>%
  pack_rows(index = table(exit_type_hh$category))
```


## Demographics by Mediciad coverage among those exiting
Some subanalyses of outcomes following rely on Medicaid claims data, which are restricted to those who had Medicaid coverage before and/or after exit. Medicaid coverage here is defined as being enrolled in a Medicaid program that provides full benefits for at least 7 of 12 months before/after exit.

The tables below illustrate demographic differences between those with Medicaid coverage before/after exit, among those with an exit.

### Individual demographics (7+ months coverage)
``` {r exitmcaid7priorind, include=TRUE}
left_join(exit_mcaid_7prior_demogs, exit_mcaid_7after_demogs, by = c("category", "group")) %>%
  select(-category) %>%
  kbl(col.names = c("", 
                    paste0("No coverage prior to exit (N =", number(nrow(covariate_exits[covariate_exits$full_cov_7_prior == FALSE, ]), big.mark = ","), ")"), 
                    paste0("Coverage prior to exit (N =", number(nrow(covariate_exits[covariate_exits$full_cov_7_prior == TRUE, ]), big.mark = ","), ")"),
                    paste0("No coverage after exit (N =", number(nrow(covariate_exits[covariate_exits$full_cov_7_after == FALSE, ]), big.mark = ","), ")"), 
                    paste0("Coverage after exit (N =", number(nrow(covariate_exits[covariate_exits$full_cov_7_after == TRUE, ]), big.mark = ","), ")")
                    )) %>%
  kable_paper("hover", full_width = F, position = "left") %>%
  column_spec(2, border_left = T) %>%
  column_spec(4, border_left = T) %>%
  pack_rows(index = table(exit_mcaid_7prior_demogs$category))
```

### Household demographics (7+ months coverage)
``` {r exitmcaid7priorhh, include=TRUE}
left_join(exit_mcaid_7prior_hh, exit_mcaid_7after_hh, by = c("category", "group")) %>%
  select(-category) %>%
  kbl(col.names = c("", 
                    paste0("No coverage prior to exit (N =", number(nrow(covariate_exits[covariate_exits$full_cov_7_prior == FALSE, ]), big.mark = ","), ")"), 
                    paste0("Coverage prior to exit (N =", number(nrow(covariate_exits[covariate_exits$full_cov_7_prior == TRUE, ]), big.mark = ","), ")"),
                    paste0("No coverage after exit (N =", number(nrow(covariate_exits[covariate_exits$full_cov_7_after == FALSE, ]), big.mark = ","), ")"), 
                    paste0("Coverage after exit (N =", number(nrow(covariate_exits[covariate_exits$full_cov_7_after == TRUE, ]), big.mark = ","), ")")
                    )) %>%
  kable_paper("hover", full_width = F, position = "left") %>%
    column_spec(2, border_left = T) %>%
  column_spec(4, border_left = T) %>%
  pack_rows(index = table(exit_mcaid_7prior_hh$category))
```

